---
title: "Analysis of comprehensive crime characteristics"
subtitle: "A Multidimensional Study Based on Age, Gender and Crime Type"
author: 
  - Yawen Tan
thanks: "Code and data are available at: https://github.com/YawennnnnnTan/Analysis-of-Crime-count"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)
library(here)
library(kableExtra)
data <- read_csv(here::here("data/analysis_data.csv"))
raw_data <- read_csv(here::here("data/raw_data.csv"))
```

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(ggplot2)
library(here)
library(kableExtra)
data <- read_csv(here::here("data/analysis_data.csv"))
raw_data<- read_csv(here::here("data/raw_data.csv"))

```



```{r}
#| label: age_group-crime
#| echo: false
#| fig-cap: Understanding Crime Numbers:A Breakdown by Age Group
#| warning: false
#| message: false

library(ggplot2)
age_summary <- data %>%
  group_by(age_group) %>%
  summarise(crime_count = sum(crime_count))

ggplot(age_summary, aes(x = age_group, y = crime_count)) + 
  geom_bar(stat = "identity", width = 0.7, fill = "lightblue") +
  labs(title = "Crime Count by Age Group", 
       x = "Age Group", 
       y = "Crime Count") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold", color = "#2E3A87"),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major = element_line(color = "gray", linetype = "dashed"),
    panel.grid.minor = element_blank()
  )

```




```{r}
#| label: gender-crime
#| fig-cap: Gender-Based Crime Counts:A Statistical Overview
#| echo: false
#| warning: false
#| message: false

library(ggplot2)
library(dplyr)

colors <- c("Male" = "lightgreen", "Female" = "lightcoral")
sex_summary <- data %>%
  group_by(sex) %>%
  summarise(crime_count = sum(crime_count))

max_value <- max(sex_summary$crime_count)

ggplot(sex_summary, aes(x = sex, y = crime_count,fill = sex)) + 
  geom_bar(stat = "identity", width = 0.7) +
  scale_fill_manual(values = colors) +
  geom_text(aes(label = crime_count), 
            vjust = 1.5,   
            size = 5,       
            color = "white") +
  geom_hline(yintercept = max_value, color = "blue", linetype = "dashed", size = 1) +
  labs(title = "Crime Count by Gender", 
       x = "Gender", 
       y = "Crime Count") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold", color = "#2E3A87"),
    legend.title = element_text(size = 12, face = "bold"),  
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major = element_line(color = "gray", linetype = "dashed"),
    panel.grid.minor = element_blank()
  )


```




```{r}
#| label: crime_type-crime
#| fig-cap: Distribution of Crime Types:A Comparative View
#| echo: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2)

# Summarize the average number of each different crime type
crime_type_summary <- data %>%
  group_by(crime_type) %>%
  summarise(total_crime_count = sum(crime_count, na.rm = TRUE))

# Graph
ggplot(crime_type_summary, aes(x = "", y = total_crime_count, fill = crime_type)) + 
  geom_bar(stat = "identity", width = 1,color='white') + 
  coord_polar("y") +
  labs(title = "Distribution of Crime Types", 
       fill = "Crime Type") +
  geom_text(aes(label = paste0(round(total_crime_count / sum(total_crime_count) * 100, 1), "%")),
             position = position_stack(vjust = 0.5), 
             color = "white", size = 4)+
  theme_minimal()+
  theme(
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold", color = "#2E3A87"),
    axis.title.x = element_text(size = 12, face = "bold"), 
    axis.title.y = element_text(size = 12, face = "bold"),
    axis.text.x = element_blank(),  # 隐藏 x 轴文本
    axis.ticks = element_blank(),    # 隐藏 x 轴刻度线
    panel.grid = element_blank(),     # 隐藏网格线
    legend.position = "right",        # 调整图例位置
    legend.title = element_text(size = 12, face = "bold"),  # 图例标题样式
    legend.text = element_text(size = 10)  # 图例文本样式
  )
```

```{r}
#| label: gender-crime_type
#| fig-cap: Comparative Analysis of Crime Counts by Gender and Type
#| echo: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2)

# 汇总每种性别和犯罪类型的犯罪数量
sex_crime_summary <- data %>%
  group_by(sex, crime_type) %>%
  summarise(total_crime_count = sum(crime_count, na.rm = TRUE), .groups = 'drop')

# 绘制分组条形图
ggplot(sex_crime_summary, aes(x = crime_type, y = total_crime_count, fill = sex)) + 
  geom_bar(stat = "identity", position = "dodge") +  # 使用 position = "dodge" 使得不同性别的条形并排显示
  labs(title = "Crime Count by Gender and Crime Type", 
       x = "Crime Type", 
       y = "Total Crime Count", 
       fill = "Gender") +
  theme_minimal() +
  coord_flip() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold", color = "#2E3A87"),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    legend.title = element_text(size = 12, face = "bold"),
    panel.grid.major = element_line(color = "gray", linetype = "dashed"),
    panel.grid.minor = element_blank()
  )
```


```{r}
#| label: gender-age_group
#| fig-cap: Comparative Analysis of Crime Counts by Gender and Age Group
#| echo: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2)
# 汇总每种gender和age_group的犯罪数量
sex_crime_summary <- data %>%
  group_by(age_group, sex) %>%
  summarise(total_crime_count = sum(crime_count, na.rm = TRUE), .groups = 'drop')

# 绘制折线图
ggplot(sex_crime_summary, aes(x = age_group, y = total_crime_count, color = sex, group = sex)) + 
  geom_line(size = 1) +  # 使用折线
  geom_point(size = 3) +  # 添加数据点以便于查看
  labs(title = "Crime Count by Age Group and Gender", 
       x = "Age Group", 
       y = "Total Crime Count", 
       color = "Gender") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 18, face = "bold", color = "#2E3A87"),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    legend.title = element_text(size = 12, face = "bold"),  
    panel.grid.major = element_line(color = "gray", linetype = "dashed"),
    panel.grid.minor = element_blank()
  )

```




```{r}
#| label: age-crime_type
#| fig-cap: Comparative Analysis of Crime Counts by Age and Crime Type
#| echo: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2)

# 汇总每种age和犯罪类型的犯罪数量
sex_crime_summary <- data %>%
  group_by(age_group, crime_type) %>%
  summarise(total_crime_count = sum(crime_count, na.rm = TRUE), .groups = 'drop')

# 绘制分组条形图
ggplot(sex_crime_summary, aes(x = age_group, y = total_crime_count, fill = crime_type)) + 
  geom_bar(stat = "identity", position = "dodge") +  # 使用 position = "dodge" 使得不同性别的条形并排显示
  labs(title = "Crime Count by Age Group and Crime Type", 
       x = "Age Group", 
       y = "Total Crime Count", 
       fill = "Crime Type") +
  theme_minimal() +
  coord_flip() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold", color = "#2E3A87"),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    axis.text = element_text(size = 10),
    legend.title = element_text(size = 12, face = "bold"),  
    panel.grid.major = element_line(color = "gray", linetype = "dashed"),
    panel.grid.minor = element_blank()
  )

```








# Introduction

You can and should cross-reference sections and sub-sections. We use @talia, @opendatatorotno, and @rohan.

The remainder of this paper is structured as follows. @sec-mydatasection



# Data {#sec-mydatasection}
## Raw Data

```{r}
#| label: tbl-raw-data
#| tbl-cap: First 8 entries of Raw Crime Count Dataset
#| echo: false
#| warning: false
#| message: false

#Graph
head_raw_data <- head(raw_data,8)
# Note there is a type in Description within the original data set itself
knitr::kable(head_raw_data[, 1:4], format = "simple", col.names = c('_id','REPORT_YEAR','CATEGORY', 'SUBTYPE'))
knitr::kable(head_raw_data[, 5:9], format = "simple", col.names = c('ASSAULT_SUBTYPE','SEX','AGE_GROUP', 'AGE_COHORT','COUNT_'))

```


-   **_id** - Unique row identifier for Open Data database
-   **REPORT_YEAR** - Year crime was reported from 2014 to 2023
-   **CATEGORY** - Crime category:
    -   Crimes Against the Person
-   **SUBTYPE** - Crime category subtype:
    -   Assault
    -   Sexual Violation
    -   Robbery
    -   OtherAssault Peace Officer
-   **ASSAULT_SUBTYPE** - Subtypes of assault (see @sec-appendixA for details)
    -   Assault Peace Officer
    -   Other
    -   N/A: Not recorded
    -   Aggravated Peace Officer
    -   Assault Peace Officer Weapon/Bodily Harm
    -   Assault Resist Arrest
-   **SEX** - Sex of identified victim
    -   Female
    -   Male
-   **AGE_GROUP** - Age group of identified victim, adult or youth
-   **AGE_COHORT** - Age cohort of identified victim (see @sec-appendixA for details)
    -   <12: the age of victim less than 12 years old
    -   12 to 17: the age of victim lbetween 12 and 17 years old
    -   18 to 24: the age of victim lbetween 18 and 24 years old
    -   25 to 34: the age of victim lbetween 25 and 34 years old
    -   35 to 44: the age of victim lbetween 35 and 44 years old
    -   45 to 54: the age of victim lbetween 45 and 54 years old
    -   55 to 64: the age of victim lbetween 55 and 64 years old
    -   65+: the age of victim larger than 65
-   **COUNT_** - Count of identified victims


## Cleaned Data(Analysis Data)


```{r}
#| label: tbl-data
#| tbl-cap: First 8 entires of Cleaned Crime Count Dataset
#| echo: false
#| warning: false
#| message: false

#Table
head_data <- head(data,8)
# Note there is a type in Description within the original data set itself
knitr::kable(head_data[, 1:4], format = "simple", col.names = c('crime_type', 'sex', 'age_group','crime_count'))

```


## Data summary


## Discussion of Data select
Explain why we select this 4 parameter, emphazised the reason of getting rid of other variables


Some of our data is of penguins (@fig-marriage), from @palmerpenguins.



Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)



# Result
## 1
## 2



# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

# Conclusion









\newpage

\appendix

# Appendix {-}

## Appendix A {#sec-appendixA}
Information on priority levels of Medical Priority Dispatch System (MPDS) ratings was sourced from @citePriorityDocument. Below is the severity of each level.



# Additional data details



\newpage


# References